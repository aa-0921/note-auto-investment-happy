// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // =========================================================================
    // キーワード設定：記事の題材（topics）と切り口（patterns）
    // =========================================================================
    // 記事は「topics × patterns」の組み合わせで自動生成されます。
    // ・変更する場合：配列内の文字列を編集する
    // ・追加する場合：配列に新しい文字列を追加する（末尾にカンマを忘れずに）
    // ・使わない場合：行頭に // を付けてコメントアウトする
    // ・過去のセットを残したい場合：そのままコメントアウトで残しておける
    // =========================================================================

    // 記事の「題材・テーマ」。ここを変えると「何について書くか」が変わる。
    const topics = [
      '資産運用の基礎',
      '投資初心者向けガイド',
      // 投資信託について多めに
      '投資信託',
      '投資信託のメリット',
      '株式投資の始め方',
      'FIRE（経済的自立・早期退職）',
      'FIRE達成のための戦略',
      '資産形成の基本',
      '投資初心者の悩み',
      '長期投資のメリット',
      '投資家のマインドセット',
      '資産運用の最初のステップ',
      '効率的な投資ポートフォリオ',
      '投資で失敗しないための心構え',
      '初心者からの資産形成',
      '成功投資家の1日・投資スタイル',
      '自身の投資における成功談・失敗談',
      '投資のメリット',
      '資産運用のメリット',
      '未経験からの投資開始',
      '個人投資家のメリット',
      '投資学習の悩み',
      '挫折しないための投資習慣',
      '未経験からの資産運用',
    //   'リモート投資のメリット',
    //   'リモート投資で解決できること',
      '投資のコスパがいい理由',
    //   '副業やフリーランスとしても投資しやすい',
      '実力主義で資産アップしやすい',
      'スキルを身につければ収益アップしやすい',
      '投資力がつく',
      '自分の資産を作れるようになる',
      '金融リテラシーが自然と身につくケースも多い（金融のドキュメントが多いため）',
      '場所や時間に縛られない生き方ができる',
      '家族や友人の資産形成などでサポートしてあげられる',
      '自己表現の手段になる',
      '人生の選択肢が増える',
      '学生や若いうちからでも活躍しやすい',
      '永続的に学び続けられる楽しさがある',
      '将来的に起業・資産運用に結びつけられる',
      '資産形成の達成感が感じられる',
      '世界中の人々に価値提供ができる',
      '年収が高い傾向がある',
      '投資市場が続く限り市場が拡大し続けている',
      // ----------------------------------
      '投資を始めることで得られる5つの大きなメリット',
      'なぜ今、投資を始めるべきなのか？初心者に伝えたい理由',
      '投資で人生が変わる！資産形成がもたらす自由な未来',
      '貯金だけでは足りない時代に投資が必要な理由',
      '投資初心者が知っておくべき投資の本当のメリット',
      '少額から始められる投資で実現できること',
      '投資で得られる経済的自由と時間の自由',
      '投資を始めることで手に入る心の余裕',
      '投資がもたらす将来への安心感と可能性',
      '投資で実現する理想のライフスタイル',
      '投資を始めた人が語る人生の変化',
      '投資で得られる複利効果のすごさ',
      '投資がもたらす収入の多様化',
      '投資で実現する早期リタイアの可能性',
      '投資を始めることで広がる選択肢',
      '投資で得られる金融リテラシーの向上',
      '投資がもたらす自己成長と学び',
      '投資で実現する家族の未来への投資',
      '投資を始めることで得られる自信',
      '投資がもたらす経済的な自立',
      '投資で実現する夢や目標の達成',
      '投資を始めることで得られる知識と経験',
      '投資がもたらす社会への理解',
      '投資で実現する時間とお金の自由',
      '投資を始めることで得られる仲間との出会い',
      '投資がもたらす長期的な資産形成',
      '投資で実現するインフレ対策',
      '投資を始めることで得られる心理的な安心',
      '投資がもたらす収入の増加',
      '投資で実現する老後の安心',
      '投資を始めることで得られる挑戦する勇気',
      '投資がもたらす人生の豊かさ',
      '投資で実現する理想の働き方',
      '投資を始めることで得られる視野の広がり',
      '投資がもたらす経済的な余裕',
      '投資で実現する夢の実現',
      '投資を始めることで得られる成長',
      '投資がもたらす未来への投資',
      '投資で実現する自由な生き方',
      '投資を始めることで得られる可能性',
      '投資がもたらす人生の選択肢',
      '投資で実現する経済的な成功',
      '投資を始めることで得られる学び',
      '投資がもたらす資産の増加',
      '投資で実現する理想の未来',
      '投資を始めることで得られる自由',
      '投資がもたらす人生の変化',
      // ーーーーーーーーーーーーーーーーーーーーーーーーーーー
      // 投資・資産運用カテゴリに合わせた題材（20件）
      'なぜか資産が増える人の共通点',
      '投資初心者が最初にやるべきこと',
      'つみたて投資で失敗しない方法',
      'NISAとiDeCoの使い分け',
      '複利効果を実感した人の習慣',
      '少額から始める資産形成のコツ',
      '投資で後悔している人がやっていたこと',
      '長期投資が続く人の考え方',
      'インフレに負けない資産の持ち方',
      '老後資金を貯める現実的なペース',
      '投資の勉強で損しない選び方',
      'ポートフォリオの基本の組み方',
      '暴落時にパニックにならない心構え',
      '配当金で不労所得を作る方法',
      'FIREを目指す人の資産形成',
      '投資信託と個別株の向き不向き',
      '投資で人生が変わった人の体験談',
      '初心者がやってしまいがちな失敗',
      '経済ニュースの見るべきポイント',
      '投資を始めるのに遅いということはない',
    ];

    // 記事の「切り口・フォーマット」。ここを変えると「どんな角度で書くか」が変わる。（投資・資産運用向けに更新）
    // const patterns = [
    //   '一歩踏み込んだ理解',
    //   '具体的な活用方法',
    //   '楽にする方法',
    //   '投資することのメリット',
    //   '複利効果の威力',
    //   // ランキングを多めに
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'ランキング-トップ5',
    //   'まつわるQ&Aまとめ',
    //   'やってはいけないNG行動',
    //   '初心者が最初の1ヶ月でやることリスト',
    //   'プロに聞いた極意',
    //   '初心者が最初の1週間でやることリスト',
    //   '専門家に聞いた極意',
    //   '正しい理解',
    //   '続けるためのモチベーション維持法',
    //   'ありがちな勘違いと正しいやり方',
    //   '成功例・失敗例から学ぶ',
    //   '「何から始めるべきか」という初心者の疑問に答える',
    //   '具体的な投資フェーズと目標設定',
    //   'モチベーション維持のコツや、投資を継続するためのマインドセット',
    //   'つみたてNISAとiDeCoの基本的な使い方を実践的に解説',
    //   '各投資商品の「なぜ選ぶのか」という目的を明確にする',
    //   '初心者でもすぐに使える実践的な投資手法',
    //   '自身の具体的な投資経験談を交え、読者に共感と学びを提供する',
    //   '資産形成の具体的なステップや目標達成方法',
    //   '投資の面白さや大変さを伝える',
    //   'ポートフォリオ管理の重要性と具体的な方法',
    //   '投資コミュニティでの円滑なコミュニケーション術',
    //   'リスク管理を成長の機会に変えるマインドセット'
    // ];

    const patterns = [
      // '一歩踏み込んだ理解',
      // '具体的な活用方法',
      // '楽にする方法',
      // '投資することのメリット',
      // '複利効果の威力',
      // 'まつわるQ&Aまとめ',
      // 'やってはいけないNG行動',
      // '初心者が最初の1ヶ月でやることリスト',
      // 'プロに聞いた極意',
      // '初心者が最初の1週間でやることリスト',
      // '専門家に聞いた極意',
      // '正しい理解',
      // '続けるためのモチベーション維持法',
      // 'ありがちな勘違いと正しいやり方',
      // '成功例・失敗例から学ぶ',
      // '「何から始めるべきか」という初心者の疑問に答える',
      // '具体的な投資フェーズと目標設定',
      // 'モチベーション維持のコツや、投資を継続するためのマインドセット',
      // 'つみたてNISAとiDeCoの基本的な使い方を実践的に解説',
      // '各投資商品の「なぜ選ぶのか」という目的を明確にする',
      // '初心者でもすぐに使える実践的な投資手法',
      // '自身の具体的な投資経験談を交え、読者に共感と学びを提供する',
      // '資産形成の具体的なステップや目標達成方法',
      // '投資の面白さや大変さを伝える',
      // 'ポートフォリオ管理の重要性と具体的な方法',
      // '投資コミュニティでの円滑なコミュニケーション術',
      // 'リスク管理を成長の機会に変えるマインドセット'


      // ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
      '投資を始めることで得られる具体的なメリット',
      '投資がもたらす人生への好影響',
      '投資を始めるべき理由を初心者向けに解説',
      '投資で実現できる理想の未来',
      '投資のメリットを実体験から語る',
      // ランキングを多めに
      'ランキング-トップ5',
      'ランキング-トップ5',
      'ランキング-トップ5',
      'ランキング-トップ5',
      '投資のメリットに関するQ&Aまとめ',
      '投資を始めないと損する理由',
      '投資初心者が最初の1ヶ月で実感できるメリット',
      '投資家が語る投資の本当の価値',
      '投資初心者が最初の1週間で感じられる変化',
      '投資の専門家が推す投資を始めるべき理由',
      '投資のメリットを正しく理解する',
      '投資を続けることで得られる長期的なメリット',
      '投資に関するよくある誤解と真実',
      '投資で成功した人の体験談から学ぶ',
      '「なぜ投資を始めるべきか」という初心者の疑問に答える',
      '投資のメリットを段階的に解説',
      '投資を継続することで得られる心理的なメリット',
      '投資のメリットを初心者にもわかりやすく説明',
      '投資を選ぶべき理由を明確にする',
      '投資初心者でもすぐに実感できるメリット',
      '自身の投資経験から語る投資のメリット',
      '投資で得られる具体的なメリットとその実現方法',
      '投資のメリットを実体験から伝える',
      '投資で得られるメリットを体系的に解説',
      '投資コミュニティで語られる投資のメリット',
      '投資のメリットを成長の機会として捉える',
      // ーーーーーーーーーーーーーーーーーーーーーーーーーーー
      // 投資・資産運用カテゴリに合わせた切り口（20件）
      'なぜか〇〇になる人の共通点',
      'たった1つで資産が変わる〇〇',
      '〇〇が教えてくれなかった本当のこと',
      '専門家が「やめなさい」と言う〇〇',
      '〇〇する人としない人の決定的な違い',
      '〇〇で資産が変わった話',
      '知らないと損する〇〇の話',
      '〇〇した人だけが資産が増える',
      '〇〇を試したら資産形成がうまくいった',
      '〇〇で資産が増えた人の特徴',
      '〇〇する前に知っておきたい3つのこと',
      'なぜか資産が増えない人がやってる〇〇',
      '〇〇が続く人と続かない人の違い',
      '〇〇で投資に失敗する人の共通点',
      '〇〇をやめたら資産が増え始めた',
      '〇〇で後悔している投資初心者へ',
      '〇〇が得意な人が無意識にやっていること',
      '〇〇で悩んでいる人に伝えたいこと',
      '〇〇を甘く見てる人が知らないリスク',
      '〇〇で資産形成が好転し始める方法',
    ];

    const rewriteConditionsLines = [
      'あなたはプロの投資家で、プロの編集者です。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、学習アドバイス、キャリアのヒントを交えて厚くリライト・追記してください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 文章作成時に多めに、たくさん絵文字を使用してください。各行に1つくらいは入れてください。',
      '- この記事を読んだ人が投資したい、とモチベーションが上がるような内容にしてください。',
      '- 読みやすさを重視してください',
      '- 外部のサービスや証券会社、金融機関の具体的な名前やURLは紹介しないでください。',
      '- 仮のURL（https://example.com等）や架空のリンクは一切使用しないでください。',
      '- リンクやURLの記載は避け、テキストのみで内容を説明してください。',
      '- 「わかりました！」「〜しますね」「〜について〜リライトします」などの依頼内容の復唱や承諾の言葉は一切出力しないでください。',
      '- 依頼内容の確認や再説明は不要です。すぐに記事本文から始めてください。',
    ];

    // LLM用システムプロンプト
    const systemMessage = 'あなたは日本語のnote記事編集者です。絶対に英語や他言語は使用せず、日本語のみで記事を作成してください。英語が混じった場合は、必ず日本語に翻訳して出力してください。';

    // 記事生成プロンプト条件（投資・資産運用向けに更新）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル] | 投資 | 資産運用 | 株 | フォロバ | フォロバ100 」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'すべて日本語で出力してください。',
      '英語や他言語が混じらないようにしてください。絶対に英語は使用しないでください。',
      '切り口に沿った内容になるようにしてください。',
      'あなたはプロの投資家で、プロの編集者です。',
      '読みやすさを重視してください',
      'もし題材・切り口を鑑みて可能であればランキング形式にしてください',
      '改行を多めに入れて、読みやすくしてください。',
      '文章作成時に多めに、たくさん絵文字を使用してください。各行に1つくらいは入れてください。',
      'この記事を読んだ人が投資したい、とモチベーションが上がるような内容にしてください。',
      '投資初心者がつい読みたくなるような、やさしく親しみやすい内容にしてください。',
      '現役の投資家向けの難しい内容や専門的すぎる話題は避けてください。',
      '記事内で「こんにちは！○○と申します」のような自己紹介や名前を名乗ることは避けてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '外部のサービスや証券会社、金融機関の具体的な名前やURLは紹介しないでください。',
      '仮のURL（https://example.com等）や架空のリンクは一切使用しないでください。',
      'リンクやURLの記載は避け、テキストのみで内容を説明してください。',
      '「わかりました！」「〜しますね」「〜について記事を作成します」などの依頼内容の復唱や承諾の言葉は一切出力しないでください。',
      '依頼内容の確認や再説明は不要です。すぐに記事タイトル（# ）から始めてください。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#資産運用 #投資 #運用 #株 #投資信託 #FIRE」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // マガジン誘導文
    const magazinePromotion = [
      // '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
      // '',
      // '✅「そろそろ資産運用、何か始めたい！」というあなたへ',
      // '',
      // '投資に興味はあるけど、「何から始めればいい？」「失敗が怖い…」そんな不安を、無料で解消できるマガジンを用意しました。',
      // '',
      // '【早めに不安を払拭する資産運用】',
      // '✔ まずは小さく始めたい',
      // '✔ 仕組みをシンプルに知りたい',
      // 'そんな人にピッタリです。',
      // '',
      // '安心して一歩踏み出すヒントを、無料でどうぞ。',
      // '',
      // 'https://note.com/investment_happy/m/m76229c09696b',
      // '',
      // '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
      // '',
    ].join('\n');

    // アソシエイト表記文（参考実装の文言）
    const amazonAssociateText =
      'Amazon のアソシエイトとして、「まずは100円から💹投資|運用|資産形成」は適格販売により収入を得ています。';

    // おすすめ記事セクションの設定
    const recommendedArticlesTitle = '他のおすすめ記事🉐';
    const recommendedArticlesUrls = [
      'https://note.com/investment_happy/n/n5c67b3b1e649',
      'https://note.com/investment_happy/n/n8774ad58b529',
      'https://note.com/investment_happy/n/nfa3e86e77e99',
      'https://note.com/investment_happy/n/n078f5f169b29',
    ];

    // 記事の最初と最後に追加するコメント募集テキスト
    const commentRequestText =
      'コメントいただけると大変励みになります💰✨ 記事で扱ってほしい題材やテーマも募集しております。ご意見やご感想など、どのような内容でもお待ちしておりますので、気軽にコメントいただけると嬉しいです📈';

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      commentRequestText,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      affiliateLinks,
      magazinePromotion,
      amazonAssociateText,
      // Audible・Kindleアフィリエイト設定（affiliateConfigから取得）
      affiliateTag: affiliateConfig.affiliateTag,
      audibleAffiliateEnabled: affiliateConfig.audibleAffiliateEnabled,
      kindleAffiliateEnabled: affiliateConfig.kindleAffiliateEnabled,
      // おすすめ記事セクション設定
      recommendedArticlesTitle,
      recommendedArticlesUrls,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
